# JWT 配置说明

## JWT 有效时间配置

JWT（JSON Web Token）的有效时间现在可以通过环境变量进行配置。

### 配置变量

- **变量名**: `JWT_EXPIRATION_DAYS`
- **类型**: 字符串（数字）
- **默认值**: `"7"`（7天）
- **单位**: 天

### 配置位置

#### 1. 开发环境和生产环境
在 `wrangler.jsonc` 文件的 `vars` 部分：

```json
{
  "vars": {
    "JWT_EXPIRATION_DAYS": "7"
  }
}
```

#### 2. 本地开发（可选）
如果需要在本地开发时使用不同的过期时间，可以在 `.dev.vars` 文件中添加：

```ini
# JWT 过期时间（天数）
JWT_EXPIRATION_DAYS=7
```

**注意**: `.dev.vars` 中的配置会覆盖 `wrangler.jsonc` 中的配置。

### 配置示例

| 需求 | 配置值 | 说明 |
|------|--------|------|
| 1天过期 | `"1"` | 适用于测试环境 |
| 7天过期（默认） | `"7"` | 推荐的生产环境配置 |
| 30天过期 | `"30"` | 长期有效token |
| 90天过期 | `"90"` | 超长期有效token |

### 生效机制

1. **JWT Token**: 生成的JWT token会包含过期时间戳
2. **KV存储**: Cloudflare KV中存储的token也会使用相同的过期时间
3. **自动清理**: 过期的token会自动从KV存储中清除

### 修改配置后的操作

1. 修改 `wrangler.jsonc` 中的 `JWT_EXPIRATION_DAYS` 值
2. 重新部署应用：
   ```bash
   npm run deploy
   ```
3. 或重启开发服务器：
   ```bash
   npm run dev
   ```

### 注意事项

- 已经生成的JWT token不会受到配置修改的影响，它们仍然按照生成时的过期时间有效
- 只有新生成的token才会使用新的过期时间配置
- 如果配置值无效（非数字），系统会自动使用默认值7天
- 建议生产环境使用较短的过期时间（如7-30天）以提高安全性

### 调试日志

当JWT生成时，控制台会输出以下调试信息：

```
🕒 JWT expiration configured: {
  days: 7,
  seconds: 604800,
  expiresAt: "2025-01-08T10:22:28.200Z"
}
```

这可以帮助您确认配置是否正确生效。
